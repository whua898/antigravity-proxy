# Antigravity-Proxy

> ä¸€ä¸ªåŸºäº MinHook çš„ Windows DLL ä»£ç†æ³¨å…¥å·¥å…·ï¼Œç”¨äºæ‹¦æˆªå’Œé‡å®šå‘ç½‘ç»œæµé‡ã€‚

[![Build Status](https://github.com/yuaotian/antigravity-proxy/actions/workflows/build.yml/badge.svg)](https://github.com/yuaotian/antigravity-proxy/actions)
[![License](https://img.shields.io/badge/license-BSD--2--Clause-blue.svg)](LICENSE.txt)
[![Platform](https://img.shields.io/badge/platform-Windows%20x86%20%7C%20x64-lightgrey.svg)]()

---

## ğŸ“– é¡¹ç›®ä»‹ç»

**Antigravity-Proxy** æ˜¯ä¸€ä¸ªç”¨äº Windows å¹³å°çš„ DLL æ³¨å…¥å¼ä»£ç†å·¥å…·ã€‚é€šè¿‡ Hook Winsock APIï¼Œå®ƒå¯ä»¥é€æ˜åœ°å°†ç›®æ ‡è¿›ç¨‹çš„ç½‘ç»œè¿æ¥é‡å®šå‘åˆ°æŒ‡å®šçš„ä»£ç†æœåŠ¡å™¨ï¼Œæ— éœ€ä¿®æ”¹ç›®æ ‡ç¨‹åºæœ¬èº«ã€‚

### ä¸»è¦åº”ç”¨åœºæ™¯
- ğŸ® æ¸¸æˆåŠ é€Ÿå™¨ / ä»£ç†å·¥å…·
- ğŸ”¬ ç½‘ç»œæµé‡åˆ†æä¸è°ƒè¯•
- ğŸ›¡ï¸ å®‰å…¨ç ”ç©¶ä¸æ¸—é€æµ‹è¯•
- ğŸŒ å¼ºåˆ¶æŒ‡å®šè¿›ç¨‹ä½¿ç”¨ä»£ç†

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

| åŠŸèƒ½ | æè¿° |
|------|------|
| **ä»£ç†é‡å®šå‘** | æ‹¦æˆª `connect()` è°ƒç”¨ï¼Œå°†è¿æ¥é‡å®šå‘è‡³ SOCKS5/HTTP ä»£ç† |
| **Fake IP ç³»ç»Ÿ** | æ‹¦æˆª DNS è§£æ (`getaddrinfo`)ï¼Œè¿”å›è™šæ‹Ÿ IP å¹¶å»ºç«‹æ˜ å°„ |
| **è¶…æ—¶æ§åˆ¶** | ä¸º Socket è®¾ç½® `SO_RCVTIMEO` / `SO_SNDTIMEO`ï¼Œé˜²æ­¢ç›®æ ‡è¿›ç¨‹å¡æ­» |
| **JSON é…ç½®** | ä½¿ç”¨ `config.json` ç®¡ç†é…ç½®ï¼Œæ”¯æŒçƒ­æ›´æ–°é¢„ç•™ |
| **Fail-Safe æœºåˆ¶** | é…ç½®åŠ è½½å¤±è´¥æ—¶è‡ªåŠ¨ç›´è¿ï¼Œä¸ä¼šå¯¼è‡´ç›®æ ‡ç¨‹åºå´©æºƒ |

---

## ğŸ”§ å·¥ä½œåŸç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç›®æ ‡è¿›ç¨‹                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ åº”ç”¨ä»£ç  â”‚â”€â”€â”€â–ºâ”‚ Winsock API  â”‚â”€â”€â”€â–ºâ”‚  antigravity-proxy   â”‚  â”‚
â”‚  â”‚          â”‚    â”‚ (ws2_32.dll) â”‚    â”‚  (Hook Layer)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â–¼
                                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                        â”‚   ä»£ç†æœåŠ¡å™¨      â”‚
                                        â”‚  (SOCKS5/HTTP)   â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒæµç¨‹**:
1. DLL è¢«æ³¨å…¥åˆ°ç›®æ ‡è¿›ç¨‹
2. ä½¿ç”¨ MinHook æ¡†æ¶ Hook `connect()` å’Œ `getaddrinfo()` ç­‰ API
3. æ‹¦æˆªåˆ°çš„è¿æ¥è¯·æ±‚è¢«æ”¹å†™ä¸ºæŒ‡å‘ä»£ç†æœåŠ¡å™¨
4. (å¯é€‰) DNS è¯·æ±‚è¿”å›è™šæ‹Ÿ IPï¼Œåœ¨ `connect()` æ—¶è¿˜åŸçœŸå®åŸŸå

---

## ğŸ› ï¸ ç¼–è¯‘æ„å»º

### ä¾èµ–è¦æ±‚

| ä¾èµ–é¡¹ | ç‰ˆæœ¬è¦æ±‚ | è¯´æ˜ |
|--------|----------|------|
| CMake | >= 3.0 | æ„å»ºç³»ç»Ÿ |
| MSVC / Visual Studio | 2017+ | C/C++ ç¼–è¯‘å™¨ |
| nlohmann/json | latest | JSON è§£æåº“ (éœ€æ‰‹åŠ¨ä¸‹è½½) |

### å‡†å¤‡å·¥ä½œ

1. **ä¸‹è½½ nlohmann/json**:
   ```bash
   # ä¸‹è½½å•å¤´æ–‡ä»¶ç‰ˆæœ¬
   curl -o include/nlohmann/json.hpp https://raw.githubusercontent.com/nlohmann/json/develop/single_include/nlohmann/json.hpp
   ```
   æˆ–æ‰‹åŠ¨ä» [GitHub Releases](https://github.com/nlohmann/json/releases) ä¸‹è½½å¹¶æ”¾ç½®åˆ° `include/nlohmann/json.hpp`

### ç¼–è¯‘æ­¥éª¤

#### Windows x64 (64ä½)
```bash
# åˆ›å»ºæ„å»ºç›®å½•
mkdir build-x64 && cd build-x64

# é…ç½® (ä½¿ç”¨ x64 ç”Ÿæˆå™¨)
cmake .. -G "Visual Studio 17 2022" -A x64

# ç¼–è¯‘ Release ç‰ˆæœ¬
cmake --build . --config Release

# è¾“å‡º: antigravity-proxy.x64.dll
```

#### Windows x86 (32ä½)
```bash
# åˆ›å»ºæ„å»ºç›®å½•
mkdir build-x86 && cd build-x86

# é…ç½® (ä½¿ç”¨ Win32 ç”Ÿæˆå™¨)
cmake .. -G "Visual Studio 17 2022" -A Win32

# ç¼–è¯‘ Release ç‰ˆæœ¬
cmake --build . --config Release

# è¾“å‡º: antigravity-proxy.x32.dll
```

---

## ğŸ“ ä½¿ç”¨è¯´æ˜

### 1. é…ç½®æ–‡ä»¶

åœ¨ DLL æ‰€åœ¨ç›®å½•åˆ›å»º `config.json`:

```json
{
    "proxy": {
        "host": "127.0.0.1",
        "port": 7890,
        "type": "socks5"
    },
    "fake_ip": {
        "enabled": true,
        "cidr": "10.0.0.0/8"
    },
    "timeout": {
        "connect": 5000,
        "send": 5000,
        "recv": 5000
    }
}
```

### 2. æ³¨å…¥ DLL

ä½¿ç”¨ä»»æ„ DLL æ³¨å…¥å·¥å…·ï¼ˆå¦‚ `Process Hacker`ã€`RemoteDLL`ã€è‡ªå®šä¹‰æ³¨å…¥å™¨ï¼‰å°†ç¼–è¯‘å¥½çš„ DLL æ³¨å…¥åˆ°ç›®æ ‡è¿›ç¨‹ã€‚

### 3. éªŒè¯

- æ£€æŸ¥ DLL æ‰€åœ¨ç›®å½•ç”Ÿæˆçš„ `proxy.log` æ–‡ä»¶
- ä½¿ç”¨ Wireshark æˆ–ä»£ç†è½¯ä»¶æ—¥å¿—ç¡®è®¤æµé‡æ˜¯å¦ç»è¿‡ä»£ç†

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
antigravity-proxy/
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ MinHook.h           # MinHook å¤´æ–‡ä»¶
â”‚   â””â”€â”€ nlohmann/json.hpp   # JSON åº“ (éœ€æ‰‹åŠ¨ä¸‹è½½)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/               # æ ¸å¿ƒæ¨¡å— (Config, Logger)
â”‚   â”œâ”€â”€ network/            # ç½‘ç»œæ¨¡å— (SocketWrapper, FakeIP)
â”‚   â”œâ”€â”€ hooks/              # Hook å®ç°
â”‚   â”œâ”€â”€ hde/                # HDE åæ±‡ç¼–å¼•æ“
â”‚   â””â”€â”€ main.cpp            # DLL å…¥å£
â”œâ”€â”€ docs/                   # å¼€å‘æ–‡æ¡£
â”œâ”€â”€ CMakeLists.txt          # CMake æ„å»ºé…ç½®
â””â”€â”€ config.json             # è¿è¡Œæ—¶é…ç½® (ç¤ºä¾‹)
```

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº [BSD-2-Clause License](LICENSE.txt) å¼€æºã€‚

MinHook éƒ¨åˆ†ç‰ˆæƒå½’ Tsuda Kageyu æ‰€æœ‰ã€‚

---

## ğŸ‘¤ ä½œè€…

**GitHub**: [@yuaotian](https://github.com/yuaotian)

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼
